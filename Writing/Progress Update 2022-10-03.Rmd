---
title: "Spring Chinook Progress (2022-10-03)"
author: "Ole Shelton"
date: "10/3/2022"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Spring Chinook Distribution

```{r echo=FALSE, warnings=FALSE,include=FALSE}
# This runs the data prep scripts.
REL <-readRDS("../Processed Data/REL matrix spring-summer FRAM_2022_05.rds")
```

```{r echo=TRUE, warnings=FALSE,include=FALSE}
# This runs the data prep scripts.
library(tidyverse)
dat <- REL %>% 
        group_by(ocean.region,loc.numb,release_year,n.year) %>% 
        summarise(N=length(brood_year),SUM = sum(N.released))

x.lab <- dat %>% ungroup() %>% 
        distinct(loc.numb,ocean.region) %>% arrange(loc.numb)

dat$ocean.region <- factor(dat$ocean.region,levels=x.lab$ocean.region)

dat.fing <- dat %>% filter(n.year==1) %>% full_join(x.lab,.)
dat.year <- dat %>% filter(n.year==2) %>% full_join(x.lab,.)

dat.fing$ocean.region <- factor(dat.fing$ocean.region,levels=x.lab$ocean.region)
dat.year$ocean.region <- factor(dat.year$ocean.region,levels=x.lab$ocean.region)

BREAKS <- seq(1:10)
p.fing <- ggplot(dat.fing) +
                geom_tile(aes(x=release_year,y=ocean.region,fill=N)) +
                ggtitle("Unique hatcheries releasing Fingerlings (BY+1 release)")+ 
                scale_fill_viridis_c(breaks=BREAKS)+
                scale_y_discrete("Stock (south to north)")+
                scale_x_continuous("Release year")+
                theme_bw()
p.year <- ggplot(dat.year) +
                geom_tile(aes(x=release_year,y=ocean.region,fill=N)) +
                ggtitle("Unique hatcheries releasing Yearlings (BY+2 release)")+ 
                scale_y_discrete("Stock (south to north)")+
                scale_x_continuous("Release year")+
                scale_fill_viridis_c(breaks=BREAKS)+
                theme_bw()
p.all <- ggplot(dat) +
                geom_tile(aes(x=release_year,y=ocean.region,fill=N)) +
                ggtitle("Unique hatcheries releasing Fingerlings + Yearlings")+ 
                scale_y_discrete("Stock (south to north)")+
                scale_x_continuous("Release year")+
                scale_fill_viridis_c(breaks=BREAKS)+
                theme_bw()

BREAKS=c(1000,3000,10000,30000,100000,300000,1000000,3000000)
p.N.fing <- ggplot(dat.fing) +
                geom_tile(aes(x=release_year,y=ocean.region,fill=SUM)) +
                ggtitle("Number of Chinook Fingerlings (BY+1 release)")+ 
                scale_y_discrete("Stock (south to north)")+
                scale_x_continuous("Release year")+
                scale_fill_viridis_c(trans="log",
                              breaks=BREAKS) +              
                theme_bw()
p.N.year <- ggplot(dat.year) +
                geom_tile(aes(x=release_year,y=ocean.region,fill=SUM)) +
                ggtitle("Number of Chinook Yearlings (BY+2 release)")+ 
                scale_y_discrete("Stock (south to north)")+
                scale_x_continuous("Release year")+
                scale_fill_viridis_c(trans="log",
                              breaks=BREAKS) + 
                theme_bw()
  


```

### Spatial and Temporal Scales

Need a map 

### CWT Releases

I am currently using `r nrow(REL)` releases (one release corresponds to a single hatchery-brood year-release stage combination and may include multiple CWT tag codes) representing `r nrow(x.lab)` distinct groups. I have generally kept the number of groups large thus far and will likely combine them to reduce their number soon. Groups have varying numbers of releases and the number of releases change over time. 

```{r fig.all.releases, echo=FALSE,fig.cap="\\label{fig:all.releases} Number of releases from each origin by year (Fingerling and Yearlings)",out.width='100%'}
print(p.all)
```

```{r fig.fing.releases, echo=FALSE,fig.cap="\\label{fig:fing.releases} Number of releases from each origin by year (Fingerlings)",out.width='75%'}
print(p.fing)
```

```{r fig.year.releases, echo=FALSE,fig.cap="\\label{fig:year.releases} Number of releases from each origin by year (Yearlings)",out.width='75%'}
print(p.year)
```



corresponding 

### Fleets and recoveries

###

